üìò NarrativeRPG ‚Äî Technical Design Document (TDD)
Version: v0.2
This document defines the technical foundation of the game:
	‚Ä¢	Data schemas
	‚Ä¢	State objects
	‚Ä¢	Encounter + Location structures
	‚Ä¢	Co-op future-proofing
	‚Ä¢	Types/interfaces for Cursor development
	‚Ä¢	Flow of data between systems

‚≠ê 
Core Concepts
Encounter
The atomic gameplay unit.
A single situation‚Äîcombat, puzzle, social, hazard, or mixed.
Location
A container made of 1‚Äì3 Encounters.
Represents a short 5‚Äì10 minute session.

‚≠ê 
Encounter Schema (v0)
export type EncounterDifficulty = "easy" | "normal" | "hard" | "boss";
export type EncounterType = "combat" | "social" | "puzzle" | "hazard" | "mixed";

export interface Encounter {
  encounter_id: string;
  title: string;
  type: EncounterType;
  difficulty: EncounterDifficulty;

  description: string;  // Initial scene setup

  environment?: {
    location_hint?: string;
    lighting?: string;
    terrain?: string;
  };

  objectives: Array<{
    id: string;
    description: string;
    required: boolean;
  }>;

  enemies: Array<{
    enemy_id: string;
    name: string;
    description: string;
    is_boss?: boolean;
    stats: {
      hp: number;
      pow: number;
      agi: number;
      mag: number;
      ins: number;
      chr: number;
    };
    abilities: string[];
    behavior: string;
    drops?: string[];   // item_ids
  }>;

  npcs: Array<{
    npc_id: string;
    name: string;
    role: string;
    description: string;
  }>;

  hazards: string[];

  items: Array<{
    item_id: string;
    name: string;
    type: "weapon" | "gear" | "potion" | "quest" | "misc";
    description: string;
    effect?: string;
    rarity?: "common" | "uncommon" | "rare" | "legendary";
  }>;
}


‚≠ê 
Location Schema (v0)
Represents a short, self-contained session containing multiple Encounters.
export type ScalingMode = "fixed" | "level_sync" | "party_average";

export interface Location {
  location_id: string;
  name: string;
  region: string;
  biome: string;
  recommended_level: number;

  max_players: number;        // v0: 1 (solo)
  scaling_mode: ScalingMode;  // v0: "fixed"

  description: string;

  entry_encounter_id: string; // where the run begins
  boss_encounter_id?: string; // optional reference

  encounters: Encounter[];    // inline for v0 simplicity

  flow: Array<{
    from: string;            // encounter_id
    to: string;              // encounter_id
    condition?: string;      // freeform explanation (optional)
  }>;

  items: Array<{
    item_id: string;
    name: string;
    type: "weapon" | "gear" | "potion" | "quest" | "misc";
    description: string;
    effect?: string;
    rarity?: "common" | "uncommon" | "rare" | "legendary";
  }>;

  base_rewards: {
    xp: number;
    gold: number;
    items: string[];         // item_ids from items[]
  };
}


‚≠ê 
PlayerState (v0)
Represents the dynamic state of the player inside a Location.
export interface PlayerState {
  player_id: string;
  name: string;
  class_id: string;
  race_id: string;
  background_id: string;
  level: number;

  stats: {
    hp: number;
    pow: number;
    agi: number;
    mag: number;
    ins: number;
    chr: number;
  };

  abilities: Array<{
    id: string;
    name: string;
    description: string;
    uses_remaining?: number | null;
  }>;

  inventory: Array<{
    item_id: string;
    name: string;
    type: string;
  }>;

  status_effects: string[];
  flags: { [key: string]: boolean };
}


‚≠ê 
EncounterState (v0)
Tracks ongoing changes within a single Encounter.
export interface EncounterState {
  encounter_id: string;
  has_intro_been_shown: boolean;
  turn_number: number;
  encounter_end_reason?: string;

  enemies: Array<{
    enemy_id: string;
    current_hp: number;
    status_effects: string[];
  }>;

  enemy_state: { [enemyId: string]: 'alive' | 'defeated' | 'tied_up' };

  npcs: Array<{
    npc_id: string;
    [key: string]: any;   // e.g. "is_freed": true
  }>;

  npc_state: { [npcId: string]: 'present' | 'rescued' | 'missing' | 'dead' };

  objectives_state: { [objectiveId: string]: 'active' | 'completed' | 'failed' };
}

‚≠ê 
LocationState (v0)
Tracks a player‚Äôs progress through a Location.
export interface LocationState {
  location_id: string;
  current_encounter_id: string;
  completed_encounters: string[];
  rewards_collected: boolean;
  visited_encounters: string[];
  location_flags: { [key: string]: boolean };
}

‚≠ê 
System Flow (v0)
	‚Ä¢	Load Location JSON.
	‚Ä¢	Set current_encounter = entry_encounter_id.
	‚Ä¢	Send to AI GM:
	‚Ä¢	Location
	‚Ä¢	Current Encounter
	‚Ä¢	PlayerState
	‚Ä¢	EncounterState
	‚Ä¢	Player takes action ‚Üí GM processes ‚Üí returns:
	‚Ä¢	narration
	‚Ä¢	rolls
	‚Ä¢	updated states
	‚Ä¢	Update EncounterState.
	‚Ä¢	If encounter complete ‚Üí follow flow to next Encounter.
	‚Ä¢	If boss encounter complete ‚Üí mark location complete.
	‚Ä¢	Grant base_rewards.

‚≠ê 
Future-Proofing Notes
	‚Ä¢	Co-op support baked in early:
	‚Ä¢	max_players
	‚Ä¢	scaling_mode
	‚Ä¢	Loot system can be expanded via more detailed item subtypes.
	‚Ä¢	Encounter and Enemy definitions can later move to global databases instead of inline.
	‚Ä¢	Branching Locations can be introduced by expanding the flow section.
	‚Ä¢	Subclasses, advanced progression, and scaling models maintained outside v0.

‚≠ê 
Summary
The TDD defines:
	‚Ä¢	Encounter and Location schemas
	‚Ä¢	Player, Encounter, and Location state structures
	‚Ä¢	Flow between Encounters
	‚Ä¢	Co-op future-proof fields
	‚Ä¢	Full TypeScript-style schemas ready for Cursor
This is the authoritative technical foundation for prototype development.

